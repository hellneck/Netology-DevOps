# Домашнее задание к занятию "3.7. Компьютерные сети, лекция 2"

1. Проверьте список доступных сетевых интерфейсов на вашем компьютере. Какие команды есть для этого в Linux и в Windows?

   * ```bash
     vagrant@ubuntu-impish:~$ ip -c -br link
     lo               UNKNOWN        00:00:00:00:00:00 <LOOPBACK,UP,LOWER_UP>
     enp0s3           UP             02:27:86:57:bb:2a <BROADCAST,MULTICAST,UP,LOWER_UP>
     enp0s8           UP             08:00:27:25:7e:3a <BROADCAST,MULTICAST,UP,LOWER_UP>
     
     vagrant@ubuntu-impish:~$ ls /sys/class/net
     enp0s3  enp0s8  lo
     
     vagrant@ubuntu-impish:~$ cat /proc/net/dev
     Inter-|   Receive                                                |  Transmit
      face |bytes    packets errs drop fifo frame compressed multicast|bytes    packets errs drop fifo colls carrier compressed
         lo:   21292     276    0    0    0     0          0         0    21292     276    0    0    0     0       0          0
     enp0s3: 21666102   16474    0    0    0     0          0         0   322098    3258    0    0    0     0       0          0
     enp0s8:    1125       8    0    0    0     0          0         2     1076      14    0    0    0     0       0          0
     ```
   * ```bash
      PS C:\Users\helln> ipconfig /all

      Настройка протокола IP для Windows

        Имя компьютера  . . . . . . . . . : VivoBook
        Основной DNS-суффикс  . . . . . . :
        Тип узла. . . . . . . . . . . . . : Гибридный
        IP-маршрутизация включена . . . . : Нет
        WINS-прокси включен . . . . . . . : Нет
        Порядок просмотра суффиксов DNS . : Home

      Адаптер Ethernet VirtualBox Host-Only Network:

        DNS-суффикс подключения . . . . . :
        Описание. . . . . . . . . . . . . : VirtualBox Host-Only Ethernet Adapter
        Физический адрес. . . . . . . . . : 0A-00-27-00-00-04
        DHCP включен. . . . . . . . . . . : Нет
        Автонастройка включена. . . . . . : Да
        Локальный IPv6-адрес канала . . . : fe80::e532:36b9:e9db:6d52%4(Основной)
        IPv4-адрес. . . . . . . . . . . . : 192.168.56.1(Основной)
        Маска подсети . . . . . . . . . . : 255.255.255.0
        Основной шлюз. . . . . . . . . :
        IAID DHCPv6 . . . . . . . . . . . : 822738983
        DUID клиента DHCPv6 . . . . . . . : 00-01-00-01-28-AB-58-8C-90-E8-68-69-AC-05
        NetBios через TCP/IP. . . . . . . . : Включен

      Адаптер беспроводной локальной сети Подключение по локальной сети* 1:

        Состояние среды. . . . . . . . : Среда передачи недоступна.
        DNS-суффикс подключения . . . . . :
        Описание. . . . . . . . . . . . . : Microsoft Wi-Fi Direct Virtual Adapter
        Физический адрес. . . . . . . . . : 92-E8-68-69-AC-05
        DHCP включен. . . . . . . . . . . : Да
        Автонастройка включена. . . . . . : Да

      Адаптер беспроводной локальной сети Подключение по локальной сети* 10:

        Состояние среды. . . . . . . . : Среда передачи недоступна.
        DNS-суффикс подключения . . . . . :
        Описание. . . . . . . . . . . . . : Microsoft Wi-Fi Direct Virtual Adapter #2
        Физический адрес. . . . . . . . . : D2-E8-68-69-AC-05
        DHCP включен. . . . . . . . . . . : Да
        Автонастройка включена. . . . . . : Да

      Адаптер беспроводной локальной сети Беспроводная сеть:

        DNS-суффикс подключения . . . . . : Home
        Описание. . . . . . . . . . . . . : Realtek 8821CE Wireless LAN 802.11ac PCI-E NIC
        Физический адрес. . . . . . . . . : 90-E8-68-69-AC-05
        DHCP включен. . . . . . . . . . . : Да
        Автонастройка включена. . . . . . : Да
        Локальный IPv6-адрес канала . . . : fe80::50a3:8a16:d26f:e69c%12(Основной)
        IPv4-адрес. . . . . . . . . . . . : 192.168.0.17(Основной)
        Маска подсети . . . . . . . . . . : 255.255.255.0
        Аренда получена. . . . . . . . . . : 9 февраля 2022 г. 19:04:53
        Срок аренды истекает. . . . . . . . . . : 11 февраля 2022 г. 19:56:46
        Основной шлюз. . . . . . . . . : fe80::1%12
                                            192.168.0.1
        DHCP-сервер. . . . . . . . . . . : 192.168.0.1
        IAID DHCPv6 . . . . . . . . . . . : 126937192
        DUID клиента DHCPv6 . . . . . . . : 00-01-00-01-28-AB-58-8C-90-E8-68-69-AC-05
        DNS-серверы. . . . . . . . . . . : 192.168.0.1
        NetBios через TCP/IP. . . . . . . . : Включен

      Адаптер Ethernet Сетевое подключение Bluetooth:

        Состояние среды. . . . . . . . : Среда передачи недоступна.
        DNS-суффикс подключения . . . . . :
        Описание. . . . . . . . . . . . . : Bluetooth Device (Personal Area Network)
        Физический адрес. . . . . . . . . : 90-E8-68-69-AC-04
        DHCP включен. . . . . . . . . . . : Да
        Автонастройка включена. . . . . . : Да

      Адаптер Ethernet vEthernet (Default Switch):

        DNS-суффикс подключения . . . . . :
        Описание. . . . . . . . . . . . . : Hyper-V Virtual Ethernet Adapter
        Физический адрес. . . . . . . . . : 00-15-5D-1F-2B-00
        DHCP включен. . . . . . . . . . . : Нет
        Автонастройка включена. . . . . . : Да
        Локальный IPv6-адрес канала . . . : fe80::c4d9:ddc9:7740:3526%22(Основной)
        IPv4-адрес. . . . . . . . . . . . : 172.29.0.1(Основной)
        Маска подсети . . . . . . . . . . : 255.255.240.0
        Основной шлюз. . . . . . . . . :
        IAID DHCPv6 . . . . . . . . . . . : 369104221
        DUID клиента DHCPv6 . . . . . . . : 00-01-00-01-28-AB-58-8C-90-E8-68-69-AC-05
        NetBios через TCP/IP. . . . . . . . : Включен

      Адаптер Ethernet vEthernet (WSL):

        DNS-суффикс подключения . . . . . :
        Описание. . . . . . . . . . . . . : Hyper-V Virtual Ethernet Adapter #2
        Физический адрес. . . . . . . . . : 00-15-5D-8B-A4-CB
        DHCP включен. . . . . . . . . . . : Нет
        Автонастройка включена. . . . . . : Да
        Локальный IPv6-адрес канала . . . : fe80::40fb:85c6:1856:879e%47(Основной)
        IPv4-адрес. . . . . . . . . . . . : 172.26.192.1(Основной)
        Маска подсети . . . . . . . . . . : 255.255.240.0
        Основной шлюз. . . . . . . . . :
        IAID DHCPv6 . . . . . . . . . . . : 788534621
        DUID клиента DHCPv6 . . . . . . . : 00-01-00-01-28-AB-58-8C-90-E8-68-69-AC-05
        NetBios через TCP/IP. . . . . . . . : Включен
   
     PS C:\VagrantUbuntu> netsh interface show interface
   
     Состояние адм.  Состояние     Тип              Имя интерфейса
     ---------------------------------------------------------------------
     Разрешен       Подключен      Выделенный       VirtualBox Host-Only Network
     Разрешен       Подключен      Выделенный       VirtualBox Host-Only Network #2
     Разрешен       Отключен       Выделенный       OpenVPN Wintun
     Разрешен       Отключен       Выделенный       OpenVPN TAP-Windows6
     Разрешен       Подключен      Выделенный       Ethernet
     Разрешен       Отключен       Выделенный       Ethernet 2
      ```

2. Какой протокол используется для распознавания соседа по сетевому интерфейсу? Какой пакет и команды есть в Linux для этого?

   * `Link Layer Discovery Protocol (LLDP)` — протокол канального уровня, который позволяет сетевым устройствам анонсировать в сеть 
     информацию о себе и о своих возможностях, а также собирать эту информацию о соседних устройствах. Пакет для Linux `lldpd`.
   * ```bash
     vagrant@ubuntu-impish:~$ sudo lldpctl
     -------------------------------------------------------------------------------
     LLDP neighbors:
     -------------------------------------------------------------------------------
     Interface:    enp0s8, via: LLDP, RID: 1, Time: 0 day, 00:00:01
       Chassis:
         ChassisID:    mac 0a:00:27:00:00:0b
       Port:
         PortID:       mac 0a:00:27:00:00:0b
         TTL:          3601
         PMD autoneg:  supported: yes, enabled: yes
           Adv:          1000Base-T, HD: no, FD: yes
           MAU oper type: unknown
     LLDP-MED:
       Device Type:  Generic Endpoint (Class I)
       Capability:   Capabilities, yes
     ```
   

3. Какая технология используется для разделения L2 коммутатора на несколько виртуальных сетей? Какой пакет и команды есть в Linux для этого? Приведите пример конфига.

   * `VLAN (Virtual Local Area Network)` — виртуальная локальная компьютерная сеть. Представляет собой группу хостов, имеющих возможность взаимодействовать между собой напрямую на 
   канальном уровне, хотя физически при этом они могут быть подключены к разным сетевым коммутаторам. И наоборот, устройства, 
   находящиеся в разных VLAN'ах, невидимы друг для друга на канальном уровне, даже если они подключены к одному коммутатору, и связь между этими устройствами возможна только на сетевом и более высоких уровнях.
   В современных сетях VLAN — главный механизм для создания логической топологии сети, не зависящей от её физической топологии. 
   VLAN'ы используются для сокращения широковещательного трафика в сети. Имеют большое значение с точки зрения безопасности, 
   в частности как средство борьбы с ARP-spoofing'ом.
   * Для настройки подынтерфейсов VLANов в Ubuntu точно так же, как и для сетевых интерфейсов, указываются в файле `/etc/network/interfaces`. 
   Для того чтобы информация о созданных VLAN'ах сохранилась после перезагрузки, необходимо добавить её в файл `/etc/network/interfaces`. Также необходимо установить пакет `vlan`.
   * Например:
   ```bash
   auto vlan999
   iface vlan999 inet static
        address 192.168.1.1
        netmask 255.255.255.0
        vlan_raw_device enp0s3
   ```

4. Какие типы агрегации интерфейсов есть в Linux? Какие опции есть для балансировки нагрузки? Приведите пример конфига.

   * `Bonding` – это объединение сетевых интерфейсов по определенному типу агрегации, Служит для увеличения пропускной способности и/или отказоустойчивость сети.

     Типы агрегации интерфейсов в Linux:

     `Mode-0(balance-rr)` – Данный режим используется по умолчанию. Balance-rr обеспечивается балансировку нагрузки и отказоустойчивость. В данном режиме сетевые пакеты отправляются “по кругу”, от первого интерфейса к последнему. Если выходят из строя интерфейсы, пакеты отправляются на остальные оставшиеся. Дополнительной настройки коммутатора не требуется при нахождении портов в одном коммутаторе. При разностных коммутаторах требуется дополнительная настройка.

     `Mode-1(active-backup)` – Один из интерфейсов работает в активном режиме, остальные в ожидающем. При обнаружении проблемы на активном интерфейсе производится переключение на ожидающий интерфейс. Не требуется поддержки от коммутатора.

     `Mode-2(balance-xor)` – Передача пакетов распределяется по типу входящего и исходящего трафика по формуле ((MAC src) XOR (MAC dest)) % число интерфейсов. Режим дает балансировку нагрузки и отказоустойчивость. Не требуется дополнительной настройки коммутатора/коммутаторов.

     `Mode-3(broadcast)` – Происходит передача во все объединенные интерфейсы, тем самым обеспечивая отказоустойчивость. Рекомендуется только для использования MULTICAST трафика.

     `Mode-4(802.3ad)` – динамическое объединение одинаковых портов. В данном режиме можно значительно увеличить пропускную способность входящего так и исходящего трафика. Для данного режима необходима поддержка и настройка коммутатора/коммутаторов.

     `Mode-5(balance-tlb)` – Адаптивная балансировки нагрузки трафика. Входящий трафик получается только активным интерфейсом, исходящий распределяется в зависимости от текущей загрузки канала каждого интерфейса. Не требуется специальной поддержки и настройки коммутатора/коммутаторов.

     `Mode-6(balance-alb)` – Адаптивная балансировка нагрузки. Отличается более совершенным алгоритмом балансировки нагрузки чем Mode-5). Обеспечивается балансировку нагрузки как исходящего так и входящего трафика. Не требуется специальной поддержки и настройки коммутатора/коммутаторов.
   * Пример конфигурации `/etc/network/interfaces`:
   ```bash
   auto bond0 eth0 eth1
   iface bond0 inet static
   address 10.0.0.11
   netmask 255.255.255.0
   gateway 10.0.0.254
   bond-slaves eth0 eth1
   bond-mode balance-alb
   bond-miimon 100
   bond-downdelay 200
   bond-updelay 200
   ```

5. Сколько IP адресов в сети с маской /29 ? Сколько /29 подсетей можно получить из сети с маской /24. Приведите несколько примеров /29 подсетей внутри сети 10.10.10.0/24.

   * В сети с маской /29 может быть 8 IP адресов (6 из них доступно для хостов).
   * Из сети с маской /24 можно получить 32 подсети с маской /29
   * ```bash
     10.10.10.0/29
     10.10.10.8/29
     10.10.10.16/29
     ...
     10.10.10.248/29
     ```

6. Задача: вас попросили организовать стык между 2-мя организациями. Диапазоны 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16 уже заняты. Из какой подсети допустимо взять частные IP адреса? Маску выберите из расчета максимум 40-50 хостов внутри подсети.

   * `100.64.0.0/26`

7. Как проверить ARP таблицу в Linux, Windows? Как очистить ARP кеш полностью? Как из ARP таблицы удалить только один нужный IP?

   * Проверить ARP таблицу:  
     Linux: `arp -a` `ip n`  
     Windows: `arp /a`
   * Очистить ARP кеш полностью: `ip neigh flush all`
   * Удалить только один IP: `ip neigh del 10.0.2.2 dev enp0s3` `arp -d 10.0.2.2`
